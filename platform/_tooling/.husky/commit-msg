#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the commit message
message="$(cat $1)"

## Validate Commit Message for GitHub Issue Number
# POSIX Regex:
#  Have a space followed by a hash, digits and a space or end of line
githubIssuePattern=" #[0-9]+($| )"
githubIssueUrlPattern="issues/[0-9]+"
if ! [[ $message =~ $githubIssuePattern || $message =~ $githubIssueUrlPattern ]];
then
  echo "-"
  echo "=== Error: Commit message has no associated Github Issue ==="
  echo ""
  echo "Your commit message was:"
  echo $message
  echo ""
  echo "--"
  echo "You need to reference at least one Github Issue. Like: #123"
  echo "The first mentioned issue should be the primary ticket."
  echo ""
  echo "This message was generated from the following script: platform/_tooling/.husky/commit-msg"
  echo "-"
  exit 1
fi

## Validating Commit Message for Gitmoji Intention Tag
gitmorjiIntentionPattern="^(ğŸ›|ğŸš¨|âœï¸|âœ…|ğŸ”ˆ|ğŸ’¡|ğŸ”‡|ğŸ¨|ğŸ‘½|âš¡ï¸|ğŸ‘Œ|ğŸ”¨|ğŸ“¦|ğŸ•¸|ğŸ›°|ğŸ|ğŸ¤–|ğŸ|ğŸ|ğŸ§|ğŸš‘|ğŸ”’|ğŸš€|ğŸ‰|ğŸ”–|âª|ğŸ“|ğŸ”€|ğŸ“„|ğŸ’¬|â™¿ï¸|ğŸ“ˆ|ğŸŒ|ğŸ³|ğŸ—ƒ|ğŸ’š|ğŸ‘·â€â™‚ï¸|âœ¨|ğŸš§|ğŸ’¥|ğŸ’„|ğŸ±|ğŸ”¥|ğŸšš|ğŸ”§|â¬†ï¸|â¬‡ï¸|â•|â–|ğŸ’©|ğŸ»|ğŸ–|ğŸ”º|ğŸ”») .*$"
if ! [[ $message =~ $gitmorjiIntentionPattern ]];
then
  echo "-"
  echo "=== Error: Commit message has no gitmoji tag(s) ==="
  echo ""
  echo "Your commit message was:"
  echo $message
  echo ""
  echo "--"
  echo "You need at lest one gitmoji intention tag at the"
  echo "beinning of your commit message followed by a space."
  echo ""
  echo "Refine"
  echo "  flaws: ğŸ›  ğŸš¨  âœï¸  âœ…  ğŸ”ˆ  ğŸ’¡  ğŸ”‡"
  echo "  quality: ğŸ¨  ğŸ‘½  âš¡ï¸  ğŸ‘Œ  ğŸ”¨  ğŸ“¦"
  echo "  platform: ğŸ•¸  ğŸ›°  ğŸ  ğŸ¤–  ğŸ  ğŸ  ğŸ§"
  echo "  stability: ğŸš‘  ğŸ”’"
  echo ""
  echo "Manage"
  echo "  delivery: ğŸš€  ğŸ‰  ğŸ”–  âª  ğŸ“  ğŸ”€  ğŸ“„"
  echo "  value: ğŸ’¬  â™¿ï¸  ğŸ“ˆ  ğŸŒ"
  echo "  infrastrucutre: ğŸ³  ğŸ—ƒ"
  echo "  integration: ğŸ’š  ğŸ‘·â€â™‚ï¸"
  echo ""
  echo "Create"
  echo "  features: âœ¨  ğŸš§  ğŸ’¥"
  echo "  changes: ğŸ’„  ğŸ±  ğŸ”¥  ğŸšš"
  echo "  reliablity: ğŸ”§  â¬†ï¸  â¬‡ï¸  â•  â–"
  echo "  ideas: ğŸ’©  ğŸ»  ğŸ–"
  echo ""
  echo "-"
  echo "For more information, check gitmoji.com."
  echo "This message was generated from the following script: platform/_tooling/.husky/commit-msg"
  echo "-"
  exit 1
fi